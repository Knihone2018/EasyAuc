<!DOCTYPE html>
<html>
    <head>
        <title>EasyAuc</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <script src="js/jquery-3.4.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="js/bootstrap.min.js"></script>
        <!-- <link href="css/easyaunc.css" rel="stylesheet" media="screen"> -->
        <script src="js/easyauc.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <h2>
                        EasyAuc
                    </h2>
                    <div class="row clearfix">
                        <div class="col-md-3 column">
                        </div>
                        <div class="col-md-3 column">
                        </div>
                        <div class="col-md-3 column">
                        </div>
                        <div class="col-md-3 column">
                            <br>
                            <button id="gotoemail" type="button" class="btn btn-info btn-sm float-right">Check Email</button>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <div class="jumbotron">
                        <h1>
                            <span class="text-primary">H</span>
                            <span class="text-secondary">e</span>
                            <span class="text-success">l</span>
                            <span class="text-danger">l</span>
                            <span class="text-warning">o</span>
                            <span class="text-info">!</span>
                            <span class="text-secondary">&nbsp&nbspAdministrator.</span>
                        </h1>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label>Remove User</label>
                <input type="number" class="form-control" id="remove_user">
            </div>
            <button id="remove_user_btn" type="button" class="btn btn-danger btn-sm">Remove<span style="display: none"></span></button>
            <br>
            <br>
            <div class="mb-3">
                <label>Block User</label>
                <input type="number" class="form-control" id="block_user">
            </div>
            <button id="block_user_btn" type="button" class="btn btn-danger btn-sm">Block<span style="display: none"></span></button>
            <br>
            <br>
            <div class="mb-3">
                <label>Add Category</label>
                <input class="form-control" id="add_category">
            </div>
            <button id="add_category_btn" type="button" class="btn btn-danger btn-sm">Add<span style="display: none"></span></button>
            <br>
            <br>
            <div class="mb-3">
                <label>Modify Category</label>
                <input class="form-control" id="modify_category_old" placeholder="old category">
                <input class="form-control" id="modify_category_new" placeholder="new category">
            </div>
            <button id="modify_category_btn" type="button" class="btn btn-danger btn-sm">Modify<span style="display: none"></span></button>
            <br>
            <br>
            <div class="mb-3">
                <label>Remove Category</label>
                <input class="form-control" id="remove_category">
            </div>
            <button id="remove_category_btn" type="button" class="btn btn-danger btn-sm">Remove<span style="display: none"></span></button>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Flagged Item</p>
            <div style="text-align:center">
                <table class="table row mx-0">
                    <thead class="w-100">
                        <tr class="row mx-0">
                            <th class="col-md-3">
                            </th>
                            <th class="col-md-3">
                                Name
                            </th>
                            <th class="col-md-3">
                                Category
                            </th>
                            <th class="col-md-3">
                                Flag
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="w-100">
                    </tbody>
                </table>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Current Auction</p>
            <div>
                <span>from&nbsp</span><input type="date" id="currfromtime"></input> &nbsp
                <span>to&nbsp</span><input type="date" id="currtotime"></input>
                &nbspsort by
                <select id="currsortby">
                    <option value="asc">asc</option>
                    <option value="desc">desc</option>
                </select>&nbsp
                <button id="currsearch" type="button" class="btn btn-secondary btn-sm">Search<span style="display: none"></span></button>
            </div>
            <br>
            <div style="text-align:center">
                <table class="table row mx-0">
                    <thead class="w-100">
                        <tr class="row mx-0">
                            <th class="col-md-3">
                            </th>
                            <th class="col-md-3">
                                Name
                            </th>
                            <th class="col-md-3">
                                Category
                            </th>
                            <th class="col-md-3">
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTable2" class="w-100">
                    </tbody>
                </table>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">History Auction</p>
            <div>
                <span>from&nbsp</span><input type="date" id="hisfromtime"></input> &nbsp
                <span>to&nbsp</span><input type="date" id="histotime"></input>
                &nbspsort by
                <select id="hissortby">
                    <option value="asc">asc</option>
                    <option value="desc">desc</option>
                </select>&nbsp
                <button id="hissearch" type="button" class="btn btn-secondary btn-sm">Search<span style="display: none"></span></button>
            </div>
            <br>
            <div style="text-align:center">
                <table class="table row mx-0">
                    <thead class="w-100">
                        <tr class="row mx-0">
                            <th class="col-md-3">
                            </th>
                            <th class="col-md-3">
                                Name
                            </th>
                            <th class="col-md-3">
                                Category
                            </th>
                            <th class="col-md-3">
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTable3" class="w-100">
                    </tbody>
                </table>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
        </div>
    </body>
    <footer class="footer navbar-fixed-bottom ">
        <div class="footer-copyright text-center py-3">Copyright Â© 2019 EasyAuc. All rights reserved.</div>
    </footer>
    <script type="text/javascript">
        $(function(){
            var id = getQueryVariable("userId");
            $("#id_span").html(id);
            $("#remove_user_btn").click(function(){
                var id = parseInt($("#remove_user").val());
                var url = "http://127.0.0.1:8000"+"/deleteaccount";
                var data = {
                    "userId": id
                };
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: url,
                    contentType:"application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(response.success){
                            alert("Delete account successfully!");
                        }else{
                            alert("Failed to delete account!");
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                    }
                });
            });
            $("#block_user_btn").click(function(){
                var id = parseInt($("#block_user").val());
                var url = "http://127.0.0.1:8000"+"/blockaccount";
                var data = {
                    "userId": id
                };
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: url,
                    contentType:"application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(response.success){
                            alert("Block account successfully!");
                        }else{
                            alert("Failed to block account!");
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                        alert("Failed to block account!");
                    }
                });
            });
            $("#add_category_btn").click(function(){
                var name = $("#add_category").val();
                var url = "http://localhost:9000"+"/addcategory";
                var data = {
                    "name": name
                };
                $.ajax({
                    url: url,
                    type: "POST",
                    dataType: "json",
                    contentType:"application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(response.success){
                            alert("Added a category.");
                        }else{
                            alert("Failed to add a category.");
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                        alert("Failed to add a category.");
                    }
                });
            });
            $("#modify_category_btn").click(function(){
                var old_name = $("#modify_category_old").val();
                var new_name = $("#modify_category_new").val();
                var url = "http://localhost:9000"+"/modifycategory";
                var data = {
                    "old_name": old_name,
                    "new_name": new_name
                };
                $.ajax({
                    type: "PUT",
                    dataType: "json",
                    url: url,
                    contentType:"application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(!response.success){
                            alert(response.message);
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                    }
                });
            });
            $("#remove_category_btn").click(function(){
                var name = $("#remove_category").val();
                var url = "http://localhost:9000"+"/deletecategory";
                var data = {
                    "name": name
                };
                $.ajax({
                    type: "DELETE",
                    dataType: "json",
                    url: url,
                    contentType:"application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(!response.success){
                            alert(response.message);
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                    }
                });
            });
            $("#currsearch").click(function(){
                getCurrentAuction();
            });
            $("#hissearch").click(function(){
                getHistoryAuction();
            });
            var url = "http://localhost:9000"+"/searchbyflag";
            $.ajax({
                type: "GET",
                dataType: "json",
                url: url,
                success: function (response) {
                    if(response.success){
                        createFlaggedItem(response);
                    }
                },
                error: function () {
                    //alert("Sorry, we have some problem.");
                }
            });
            getCurrentAuction();
            getHistoryAuction();
        });

        function getCurrentAuction(){
            var data={
                "status":true,
                "start_time":$("#currfromtime").val(),
                "end_time":$("#currtotime").val(),
                "sort":$("#currsortby").val()
            };
            $.ajax({
                type: "POST",
                dataType: "json",
                url: ""+"/progressitems",
                contentType:"application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    createCurrentAuction(response);
                },
                error: function () {
                    //alert("Sorry, we have some problem.");
                }
            });
        }

        function getHistoryAuction(){
            var data={
                "status":false,
                "start_time":$("#hisfromtime").val(),
                "end_time":$("#histotime").val(),
                "sort":$("#hissortby").val()
            };
            $.ajax({
                type: "POST",
                dataType: "json",
                url: ""+"/progressitems",
                contentType:"application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    createHistoryAuction(response);
                },
                error: function () {
                    //alert("Sorry, we have some problem.");
                }
            });
        }

        function createCurrentAuction(data){
            var str = "";
            for (var i=0;i<data.length;i++) {
                str = str + "<tr class='row mx-0'><td class='col-3'>"+createImage(data[i][5])+"</td>"
                        + "<td class='col-3'>" + createName(data[id][1],data[id][3]) + "</td>"
                        + "<td class='col-3'>" + data[id][2] + "</td>"
                        + "<td class='col-3'>" + createStopButton() + "<span style='display:none'>"+data[id][0]
                        +"</span></td>"
                        + "</tr>";
            }
            $("#dataTable2").html(str);
        }

        function createHistoryAuction(data){
            var str = "";
            for (var i=0;i<data.length;i++) {
                str = str + "<tr class='row mx-0'><td class='col-3'>"+createImage(data[i][5])+"</td>"
                        + "<td class='col-3'>" + createName(data.message[id][1],data.message[id][3]) + "</td>"
                        + "<td class='col-3'>" + data.message[id][2] + "</td>"
                        + "<td class='col-3'></td>"
                        + "</tr>";
            }
            $("#dataTable3").html(str);
        }

        function createFlaggedItem(data){
            var str = "";
            for (var id in data.message) {
                str = str + "<tr class='row mx-0'><td class='col-3'>"+createImage(data.message[id][4])+"</td>"
                        + "<td class='col-3'>" + createName(data.message[id][0],data.message[id][3]) + "</td>"
                        + "<td class='col-3'>" + data.message[id][1] + "</td>"
                        + "<td class='col-3'>" + data.message[id][2] + "</td>"
                        + "</tr>";
            }
            $("#dataTable").html(str);
        }
        function createName(name, url){
            var str="<a href='"+url+"'>"+name+"</a>";
            return str;
        }

        function createImage(url){
            var str="<img src="+url+"/>"
            return str;
        }

        function createStopButton(){
            var str="<button class='btn btn-sm btn-danger'></button>";
            return str;
        }

        $("#gotoemail").click(function(){
            window.location.href="http://mail.google.com";
        });
    </script>
</html>