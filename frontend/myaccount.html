<!DOCTYPE html>
<html>
    <head>
        <title>EasyAuc</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <script src="js/jquery-3.4.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="js/bootstrap.min.js"></script>
        <!-- <link href="css/easyaunc.css" rel="stylesheet" media="screen"> -->
        <script src="js/easyauc.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <h2>
                        EasyAuc
                    </h2>
                    <div class="row clearfix">
                        <div class="col-md-4 column">
                        </div>
                        <div class="col-md-2 column">
                        </div>
                        <div class="col-md-3 column">
                        </div>
                        <div class="col-md-3 column">
                            <br>
                            <button id="home" type="button" class="btn btn-warning btn-sm">Home<span style="display: none"></span></button>
                            <button id="mycart" type="button" class="btn btn-info btn-sm">My Cart<span style="display: none"></span></button>
                            <button id="myhistory" type="button" class="btn btn-info btn-sm">My History<span style="display: none"></span></button>
                            <button id="mywatchlist" type="button" class="btn btn-success btn-sm">My Watchlist<span style="display: none"></span></button>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <div class="jumbotron">
                        <h1>
                            <span class="text-primary">H</span>
                            <span class="text-secondary">e</span>
                            <span class="text-success">l</span>
                            <span class="text-danger">l</span>
                            <span class="text-warning">o</span>
                            <span class="text-info">!</span>
                        </h1>
                        <p>
                            This is your profile page. You can manage your personal information here. Please don't tell anyone about your password.
                        </p>
                        <p>
                            EasyAunc will help you find everything you like!
                        </p>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label >My Email</label>
                <input class="form-control" id="email" disabled="true">
            </div>
            <div class="mb-3">
                <label>First Name</label>
                <input class="form-control" id="firstname" disabled="true">
            </div>
            <div class="mb-3">
                <label>Last Name</label>
                <input class="form-control" id="lastname" disabled="true">
            </div>
            <div class="mb-3">
                <label>My Address</label>
                <input class="form-control" id="address" disabled="true">
            </div>
            <div class="mb-3">
                <label>Zipcode</label>
                <input class="form-control" id="zipcode" disabled="true">
            </div>
            <div class="mb-3">
                <label>City</label>
                <input class="form-control" id="city" disabled="true">
            </div>
            <div class="mb-3">
                <label>State</label>
                <input class="form-control" id="state" disabled="true">
            </div>
            <div class="mb-3">
                <label>My Bank Account</label>
                <input class="form-control" id="bankAccount" disabled="true">
            </div>
            <div class="mb-3">
                <label>Rating</label>
                <input class="form-control" id="rating" disabled="true">
            </div>
            <br>
            <button id="deleteaccount" type="button" class="btn btn-danger btn-sm">Delete This Account<span style="display: none"></span></button>
            <br>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Email</p>
            <div class="mb-3">
                <label for="email">New Email</label>
                <input type="email" class="form-control" id="new_email">
            </div>
            <div class="mb-3">
                <label for="email">Confrim New Email</label>
                <input type="email" class="form-control" id="con_email">
            </div>
            <div class="mb-3">
                <button id="changeemail" type="button" class="btn btn-danger btn-sm">Change Email<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change First Name</p>
            <div class="mb-3">
                <label>New First Name</label>
                <input class="form-control" id="new_firstname">
            </div>
            <div class="mb-3">
                <label>Confrim New First Name</label>
                <input class="form-control" id="con_firstname">
            </div>
            <div class="mb-3">
                <button id="changefirstname" type="button" class="btn btn-danger btn-sm">Change First Name<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Last Name</p>
            <div class="mb-3">
                <label>New Last Name</label>
                <input class="form-control" id="new_lastname">
            </div>
            <div class="mb-3">
                <label>Confrim New Last Name</label>
                <input class="form-control" id="con_lastname">
            </div>
            <div class="mb-3">
                <button id="changelastname" type="button" class="btn btn-danger btn-sm">Change Last Name<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Address</p>
            <div class="mb-3">
                <label>New Address</label>
                <input class="form-control" id="new_address">
            </div>
            <div class="mb-3">
                <label>Confrim New Address</label>
                <input class="form-control" id="con_address">
            </div>
            <div class="mb-3">
                <button id="changeaddress" type="button" class="btn btn-danger btn-sm">Change Address<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Zipcode</p>
            <div class="mb-3">
                <label>New Zipcode</label>
                <input class="form-control" id="new_zipcode">
            </div>
            <div class="mb-3">
                <label>Confrim New Zipcode</label>
                <input class="form-control" id="con_zipcode">
            </div>
            <div class="mb-3">
                <button id="changezipcode" type="button" class="btn btn-danger btn-sm">Change Zipcode<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change City</p>
            <div class="mb-3">
                <label>New City</label>
                <input class="form-control" id="new_city">
            </div>
            <div class="mb-3">
                <label>Confrim New City</label>
                <input class="form-control" id="con_city">
            </div>
            <div class="mb-3">
                <button id="changecity" type="button" class="btn btn-danger btn-sm">Change City<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change State</p>
            <div class="mb-3">
                <label>New State</label>
                <input class="form-control" id="new_state">
            </div>
            <div class="mb-3">
                <label>Confrim New State</label>
                <input class="form-control" id="con_state">
            </div>
            <div class="mb-3">
                <button id="changestate" type="button" class="btn btn-danger btn-sm">Change State<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Bank Account</p>
            <div class="mb-3">
                <label>New Bank Account</label>
                <input class="form-control" id="new_bankaccount">
            </div>
            <div class="mb-3">
                <label>Confrim New Bank Account</label>
                <input class="form-control" id="con_bankaccount">
            </div>
            <div class="mb-3">
                <button id="changebankaccount" type="button" class="btn btn-danger btn-sm">Change Bank Account<span style="display: none"></span></button>
            </div>
            <br>
            <br>
            <br>
            <p class="text-center font-weight-bold text-secondary">Change Password</p>
            <div class="mb-3">
                <label for="password">New Password</label>
                <input type="password" class="form-control" id="new_password">
            </div>
            <div class="mb-3">
                <label for="password">Confrim New Password</label>
                <input type="password" class="form-control" id="con_password">
            </div>
            <div class="mb-3">
                <button id="changepassword" type="button" class="btn btn-danger btn-sm">Change Password<span style="display: none"></span></button>
            </div>
            <br>
            <br>
        </div>
    </body>
    <footer class="footer navbar-fixed-bottom ">
        <div class="footer-copyright text-center py-3">Copyright © 2019 EasyAuc. All rights reserved.</div>
    </footer>
    <script type="text/javascript">
        $(function(){
            var id = getQueryVariable("userId");
            $("#home span").html(id);
            $("#home").click(function(){
                window.location.href="home.html?userId="+id;
            });
            $("#mycart span").html(id);
            $("#mycart").click(function(){
                window.location.href="cart.html?userId="+id;
            });
            $("#myhistory span").html(id);
            $("#myhistory").click(function(){
                window.location.href="history.html?userId="+id;
            });
            $("#mywatchlist span").html(id);
            $("#mywatchlist").click(function(){
                window.location.href="watchlist.html?userId="+id;
            });
            $("#deleteaccount span").html(id);
            $("#deleteaccount").click(function(){
                var url = "http://127.0.0.1:8000"+"/deleteaccount";
                var data = {
                    "userId": id
                };
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    url: url,
                    data: JSON.stringify(data),
                    success: function (response) {
                        if(response.success){
                            alert("This account has been deleted.");
                            window.location.href="home.html";
                        }
                    },
                    error: function () {
                        //alert("Sorry, we have some problem.");
                    }
                });
            });
            $("#changeemail span").html(id);
            $("#changeemail").click(function(){
                change("email");
            });
            $("#changefirstname span").html(id);
            $("#changefirstname").click(function(){
                change("firstname");
            });
            $("#changeaddress span").html(id);
            $("#changeaddress").click(function(){
                change("address");
            });
            $("#changelastname span").html(id);
            $("#changelastname").click(function(){
                change("lastname");
            });
            $("#changezipcode span").html(id);
            $("#changezipcode").click(function(){
                change("zipcode");
            });
            $("#changecity span").html(id);
            $("#changecity").click(function(){
                change("city");
            });
            $("#changestate span").html(id);
            $("#changestate").click(function(){
                change("state");
            });
            $("#changebankaccount span").html(id);
            $("#changebankaccount").click(function(){
                change("bankaccount");
            });
            $("#changepassword span").html(id);
            $("#changepassword").click(function(){
                change("password");
            });

            var url = "http://127.0.0.1:8000"+"/myaccount/";
            var data={"userId":id};
            console.log(JSON.stringify(data));
            $.ajax({
                type: "GET",
                dataType: "json",
                url: url+id,
                data:JSON.stringify(data),
                success: function (response) {
                    console.log(response);
                    if(response.success){
                        $("#email").val(response.email);
                        $("#firstname").val(response.firstname);
                        $("#lastname").val(response.lastname);
                        $("#address").val(response.address);
                        $("#city").val(response.city);
                        $("#state").val(response.state);
                        if(response.zipcode!=-1)
                            $("#zipcode").val(response.zipcode);
                        if(response.bankAccount!=-1)
                            $("#bankAccount").val(response.bankAccount);
                        $("#rating").val(response.rating);
                    }
                },
                error: function () {
                    //alert("Sorry, we have some problem.");
                }
            });
        });

        function change(name){
            name = String(name);
            var id = $("#change"+name).find("span").text();
            var temp1 = $("#new_"+name).val();
            var temp2 = $("#con_"+name).val();
            if(temp1==undefined ||temp1==null||temp1==""){
                alert("New "+name+" is empty.");
                return;
            }
            if(temp2==undefined ||temp2==null||temp2==""){
                alert("Confirm "+name+" is empty.");
                return;
            }
            if(temp1!=temp2){
                alert("Two "+name+"s are different.");
                return;
            }
            var key = "";
            var url = "http://127.0.0.1:8000";
            switch(name) {
                case "email":
                    key = "email";
                    url +="/setemail"; 
                    break;
                case "firstname":
                    key = "firstName";
                    url +="/setfirstname"; 
                    break;
                case "lastname":
                    key = "lastName";
                    url +="/setlastname"; 
                    break;
                case "address":
                    key = "address";
                    url +="/setaddress"; 
                    break;
                case "zipcode":
                    key = "zipcode";
                    url +="/setzipcode"; 
                    break;
                case "city":
                    key = "city";
                    url +="/setcity"; 
                    break;
                case "state":
                    key = "state";
                    url +="/setstate"; 
                    break;
                case "bankaccount":
                    key = "BankAccNum";
                    url +="/setbankaccountnum";
                    break;
                case "password":
                    key = "password";
                    url +="/setpassword";
                    break;
                default:
                // code block
            }
            var data = {"userId":id};
            data[key] = temp1;
            console.log(data);
            $.ajax({
                type: "POST",
                dataType: "json",
                url: url,
                data: JSON.stringify(data),
                contentType: "application/json",
                success: function (response) {
                    if(response.success){
                        alert("Your update was successful.");
                        window.location.href="myaccount.html?userId="+id;
                    }
                },
                error: function () {
                    //alert("Sorry, we have some problem.");
                }
            });
        }
    </script>
</html>